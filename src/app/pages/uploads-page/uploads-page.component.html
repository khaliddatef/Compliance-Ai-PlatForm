<section class="page">
  <div class="panel">
    <div class="panel-header">
      <div>
        <h3>Uploaded Files</h3>
        <p class="sub">Files uploaded from chat conversations.</p>
      </div>
      <button class="primary-btn" type="button" (click)="refresh()">Refresh</button>
    </div>

    <div class="filters">
      <div class="search">
        <input
          type="search"
          placeholder="Search by file, chat, or framework..."
          [(ngModel)]="searchTerm"
        />
      </div>
      <div class="filter-group">
        <label>
          Framework
          <select [(ngModel)]="frameworkFilter">
            <option *ngFor="let option of frameworkOptions" [value]="option.toLowerCase() === 'all' ? 'all' : option">
              {{ option }}
            </option>
          </select>
        </label>
        <label>
          Status
          <select [(ngModel)]="statusFilter">
            <option *ngFor="let option of statusOptions" [value]="option.toLowerCase() === 'all' ? 'all' : option">
              {{ option }}
            </option>
          </select>
        </label>
        <label>
          Sort
          <select [(ngModel)]="sortMode">
            <option value="recent">Newest</option>
            <option value="oldest">Oldest</option>
            <option value="name-asc">Name A-Z</option>
            <option value="name-desc">Name Z-A</option>
            <option value="size-desc">Size: Large-Small</option>
            <option value="size-asc">Size: Small-Large</option>
          </select>
        </label>
      </div>
    </div>

    <div class="table skeleton-table" *ngIf="loading">
      <div class="row skeleton-row" *ngFor="let _ of [1,2,3,4,5,6]">
        <div class="skeleton skeleton-line"></div>
        <div class="skeleton skeleton-line"></div>
        <div class="skeleton skeleton-pill"></div>
        <div class="skeleton skeleton-line"></div>
        <div class="skeleton skeleton-line"></div>
        <div class="skeleton skeleton-line"></div>
        <div class="skeleton skeleton-line"></div>
      </div>
    </div>

    <div class="table" *ngIf="!loading && visibleFiles.length">
      <div class="row header">
        <span>File</span>
        <span>Framework</span>
        <span>Status</span>
        <span>Uploaded</span>
        <span>Framework references</span>
        <span>Size</span>
        <span>Action</span>
      </div>
      <div class="row" *ngFor="let file of visibleFiles">
        <div class="file-cell">
          <span class="file-name" [title]="file.name">{{ file.name }}</span>
          <span class="file-meta" *ngIf="file.chatTitle">Chat: {{ file.chatTitle }}</span>
        </div>
        <span class="framework-cell" [title]="file.framework">{{ file.framework }}</span>
        <span class="status-pill" [ngClass]="file.statusClass">{{ file.status }}</span>
        <span class="date">{{ file.uploadedAt | date: 'MMM d, y' }}</span>
        <div class="reference-cell">
          <ng-container *ngIf="file.frameworkReferences.length; else noReference">
            <span class="reference-item" *ngFor="let reference of file.frameworkReferences" [title]="reference">
              {{ reference }}
            </span>
          </ng-container>
          <ng-template #noReference>
            <span class="reference-empty">â€”</span>
          </ng-template>
        </div>
        <span>{{ file.size }}</span>
        <div class="action-group">
          <button class="download-btn" type="button" (click)="downloadFile(file)">Download</button>
          <button class="delete-btn" type="button" (click)="deleteFile(file)">Delete</button>
        </div>
      </div>
    </div>

    <p *ngIf="!loading && !visibleFiles.length && !error" class="empty">No uploads yet.</p>
    <p *ngIf="error" class="empty error">{{ error }}</p>
  </div>
</section>
