<div class="bubble" [class.from-user]="message.role === 'user'" [class.action-message]="message.kind === 'action'">
  <div class="avatar" aria-hidden="true">
    <span>{{ message.role === 'user' ? 'You' : 'AI' }}</span>
  </div>
  <div class="bubble-body">
    <div class="content" *ngIf="message.kind !== 'action'">
      <div *ngFor="let line of lines" class="line" [class.bullet]="line.type === 'bullet'">
        <span *ngIf="line.type === 'bullet'" class="bullet-mark">â€¢</span>
        <span class="text">
          <ng-container *ngFor="let part of line.parts">
            <span [class.citation]="part.citation">{{ part.text }}</span>
          </ng-container>
        </span>
      </div>
    </div>
    <div class="action-pill" *ngIf="message.kind === 'action'">{{ message.content }}</div>

    <div class="action-buttons" *ngIf="message.role === 'assistant' && message.actions?.length">
      <button
        class="action-btn"
        type="button"
        *ngFor="let action of message.actions"
        (click)="selectAction(action)"
      >
        {{ action.label }}
      </button>
    </div>
    <div class="meta">
      <span class="time">{{ message.timestamp | date: 'shortTime' }}</span>
      <div class="actions" *ngIf="message.role === 'assistant'">
        <button class="tiny" type="button" (click)="copyContent()" aria-label="Copy message">
          {{ copied ? 'Copied' : 'Copy' }}
        </button>
        <button
          class="tiny"
          type="button"
          (click)="setFeedback('up')"
          [class.active]="feedback === 'up'"
          aria-label="Thumbs up"
        >
          ğŸ‘
        </button>
        <button
          class="tiny"
          type="button"
          (click)="setFeedback('down')"
          [class.active]="feedback === 'down'"
          aria-label="Thumbs down"
        >
          ğŸ‘
        </button>
      </div>
    </div>
  </div>
</div>
