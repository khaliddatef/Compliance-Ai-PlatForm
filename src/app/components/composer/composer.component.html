<div
  class="composer"
  [class.dragging]="dragging"
  (drop)="onDrop($event)"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave()"
>
  <div class="attachments" *ngIf="attachments.length">
    <div class="chip" *ngFor="let file of attachments; let i = index">
      <div class="chip-text">
        <span class="name">{{ file.name }}</span>
        <span class="size">{{ formatSize(file.size) }}</span>
      </div>
      <button type="button" class="chip-remove" (click)="removeAttachment(i)" aria-label="Remove attachment">×</button>
    </div>
  </div>

  <div class="input-row">
    <div class="input-wrap">
      <div class="input-shell">
        <button
          class="icon-btn inline-btn attach-btn"
          type="button"
          (click)="fileInput.click()"
          [disabled]="uploading"
          aria-label="Attach documents"
        >
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v14" />
            <path d="M5 12h14" />
          </svg>
        </button>

        <textarea
          #composerInput
          [(ngModel)]="draft"
          (input)="autoResize($event)"
          (keydown)="handleKeydown($event)"
          placeholder="Ask about controls, gaps, or evidence you need..."
          aria-label="Message composer"
        ></textarea>

        <button
          class="send inline-btn send-btn"
          type="button"
          (click)="submit()"
          [disabled]="!canSend"
          aria-label="Send"
        >
          <span class="spinner" *ngIf="uploading"></span>
          <svg class="icon" *ngIf="!uploading" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5l6 7-6 7" />
            <path d="M6 12h12" />
          </svg>
        </button>
      </div>

      <input
        #fileInput
        type="file"
        multiple
        accept=".pdf,.docx,.xlsx"
        class="file-input"
        (change)="onFileInput($event)"
      />

      <div class="progress" *ngIf="uploading">
        <div class="progress-track">
          <div class="progress-bar" [style.width.%]="uploadProgress || 10"></div>
        </div>
        <span class="progress-text">{{ uploadProgress ? uploadProgress + '%' : 'Uploading…' }}</span>
      </div>
    </div>
    <!-- <button (click)="reset()">reset</button> -->
  </div>
</div>
